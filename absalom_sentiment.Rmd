---
title: '*Absalom, Absalom!* Sentiment Analysis'
author: "Johannes Burgers"
output:
  html_document:
    df_print: paged
---


```{r setup, include=FALSE, message = FALSE, warning=FALSE, error=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE, error=FALSE)
```

## Introduction

The following is a brief linguistic analysis of the use of racially charged language in William Faulkner's *Absalom, Absalom!*. Faulkner's representation of race was complicated, just as his own his relationship with race was complex. As a Southern white moderate, he voiced his anguish over the dehumanization of African Americans under Jim Crow segregation, and, at the same, time could also casually refer to people as "niggers" during the public retelling of a [comic story](https://faulkner.lib.virginia.edu/display/wfaudio02_2.html#wfaudio02_2.2). Indeed, there is no shortage of literature on Faulkner and race in general, and with regards to *Absalom, Absalom!* in particular. Given this extensive critical history, it almost goes without saying that a computational analysis of word choice, especially with regard to racially charged language, cannot due justice to the complexities and nuances of either the text or Faulkner's broader critical intervention. Nevertheless, using techniques common in corpus linguistics (CL) it is possible to give a birds-eye view of how the use of certain words is patterned. This pattern can then, in turn, inform subsequent close readings. 

The following piece uses several techniques available to standard CL analysis, and one more complex analysis that is exclusively available to practitioners who have access to the *[Digital Yoknapatawpha](http://faulkner.iath.virginia.edu/)* data set. These different techniques have been split into their own sections.

- **Part 1: Statistical Overview**  
          Analysis of the general linguistic pattern of the texts including word frequency and word           correlations.
- **Part 2: Sentiment Analysis**  
          Analysis of racially charged language and the sentiments that surround the use of those             words.
- **Part 3: Character Sentiment Analysis**  
          Sentiment analysis of specific characters. Using the data available in the *DY* database,           a sentiment pattern around certain characters was created.
          
All of the data was generated using the R programming language using the `tidyverse` suite of packages for the calculations and the `plotly` library for the graphics. The full repository is available at https://github.com/joostburgers/absalom_sentiment_analysis Due to copyright issues the repository does not include the Absalom, Absalom text file used for data analysis.


## Part 1: Statistical Overview *Absalom, Absalom!*

### Text pre-processing

With any textual analysis, some pre-processing is required. The steps that follow are standard procedures in CL. The text of *Absalom, Absalom!* was read in as a txt file. It was then broken into nine chapters, and further sub-setted into sentences. The individual words were subsequently "tokenized." The process of tokenization removes capital letters, special characters, and punctuation. It enables the computer to compare words more easily. Each "stop word" was then removed. These are words like: the, a, on, at, etc. that are very frequent with in any text, and do not add to the analysis. The words were then lemmatized. Lemmatization reduces a word to the word stem. For example, Negroes becomes Negro. This way all instances of the concept "Negro" are unified as one instance. This prevents creating separate counts for words like Negro, Negroes, and Negro's.

The resulting slate of words was tagged as racially charged by adding a column called race_word and indicating TRUE or FALSE for each word. This was done by creating a list of racial words and joining it to the data table through a left sided join. Essentially, it checks to see if a word like "Negro", "White", or "Octoroon" occurs and tags it as TRUE. Such a list of racial words is necessarily imperfect as the words "black" and "white" could also denote colors and not racial designations. Still, with this pre-processing complete it is possible to provide some key statistical insights.

### Word Frequency

The chart below shows the ten most frequent non-racial words and racial words in the text. Hovering over the the individual bars reveals their precise number, and clicking on TRUE and FALSE turns that particular series on and off.

```{r load_packages}
library(tidyverse)
library(tidytext)
library(syuzhet)
library(stringi)
library(scales)
library(htmlTable)
library(stringr)
library(ggplot2)
library(plotly)
library(ggthemes)
library(textstem)
library(shiny)
library(lubridate)
library(ggiraphExtra)
```

```{r load_color_scheme, echo=FALSE}
#This is where you create your own custom color palette for the traces.
faulkner_colorway = c("#132C53","#F27A18","#ae0700","#79b473","#38726c","#76bed0","#6b2d5c","#448b2d","#e6d812")

#This controls the background color for the entire chart. Probably best left white.
faulkner_paperbackground = c("#ffffff")

#This controls the background for the plot. Probably best left white.
faulkner_plotcolor = c("#ffffff")

```



```{r load_text}
#Read in the text
absalom_df <- as.data.frame(read_file("absalom_cleaned_to_match_4_30_rev4.txt"))
colnames(absalom_df) <- "text" 

absalom_df <- absalom_df %>% 
mutate(text = gsub("[‘’]", "'", text))
```

```{r load_race_words}
#Read in the race words
race_words <- read_csv("race_words.csv")
```

```{r _load_event_sentences}
absalom_event_sentences <- read_csv("absalom_event_sentences_clean_2021_5_2.csv")

#This file was created by recomposing the text based on the "First Words" column and matching the text segments with each event using a copy of the text. As this process is quite involved it has been branched out into a separate file: absalom_sentiment_text_processing. Full details on the process can be viewed there.

```


```{r unnest_text}
#unnest the text by sentence and then label each chapter number and sentence number.
absalom_tidy <- absalom_df %>%
  unnest_regex(text, text, pattern = "Chapter [:digit:]") %>% 
  mutate(chapter = row_number()) %>%
  unnest_regex(sentences, text, pattern = "[.?!]") %>% 
  mutate(sentence_number = row_number()) %>%  
  unnest_tokens(word, sentences) 
  
```

```{r word_frequency}
#Remove the stop words to reduce over counting
data("stop_words")
absalom_stats <- absalom_tidy %>%
  anti_join(stop_words)
```


```{r add_race_words}
#Mark each race word as true and then convert every non-race word as false. then add a column for the lemmatized words.

absalom_race_stats <- absalom_stats %>%
  mutate(word_lemma = textstem::lemmatize_words(word)) %>%
  mutate(word_lemma = str_remove_all(word_lemma, "'s")) %>%
  left_join(race_words, by = "word_lemma") %>%
  mutate(race_word = replace_na(race_word, FALSE))
```


```{r create_plot}
#Create a top ten list for the plotting data
absalom_word_frequency <- absalom_race_stats %>% 
    group_by(race_word) %>% 
    count(word_lemma, sort = TRUE) %>%
    top_n(10) %>%
    mutate(word_lemma = reorder(word_lemma, n))
```


```{r message=TRUE, results='markup', fig.cap="Note: The chart displays the most frequent words based on word stem.<br> This prevents counting <i>father</i> and <i>father's</i> separately."}

#Use ploty_ly library to create a bar chart

absalom_word_frequency_plot <- plot_ly(
  absalom_word_frequency,
  x = ~ word_lemma,
  y = ~ n,
  type = "bar",
  color = ~ race_word,
  opacity=.9,
  colors= faulkner_colorway,
   hovertemplate=paste('Count: %{y}<extra></extra>')
  )

absalom_word_frequency_plot <- absalom_word_frequency_plot %>%
  layout(
    title = "Ten Most Frequent Word by Non-Race and Race Words",
    xaxis = list(title = "Word Stem"),
    yaxis = list(title = "Number of Words"),
    legend = list(title = list(text = '<b>Race Word</b>')),
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
     margin = list(l = 50, r = 50, b = 50, t = 50, pad = 4)
    
  )

div(absalom_word_frequency_plot, align = "center")
div("Figure 1: The chart displays the most frequent words based on word stem. This prevents counting 'father' and 'father's' separately.")

```

What is immediately noticeable is that the word "nigger" is the most frequent racial term. It exceeds the word "negro" by 50 counts. It occurs about a third as infrequently as the word Henry (the main character) and twice as infrequently as the racially ambiguous Charles Bon. Importantly, the occurrences of the individual names of characters is not the same as the number of times they actually occur in the text. After all, the pronouns "he" or "she" could equally well denote a character, but that is not shown here.

### Collocations

Collocation is a process of determining what words appear together. This is done by creating n-grams, where n is the number of words that might match in a sequence. By determining the n-gram around particular words, we can get a better sense of the context. For example, in her research of British Newspapers, Dawn Archer has shown that the most common bigram (n-gram of two) for Muslim is "Muslim terrorist."(CITE) Certainly this strong association between these two words indicates how Muslim's are represented in the British media. In similar fashion, we get a better sense of how Faulkner is using racial language by looking at the words immediately before and after them.

```{r}

#Create a bigram of the Absalom DF
absalom_bigrams <- absalom_df %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

#This function first separates the bigram into two words, lemmatizes each, tags the racial words, then removes all non-racial words. 
race_bigrams <- absalom_bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  mutate(word_lemma1 = textstem::lemmatize_words(word1)) %>%
  mutate(word_lemma1 = str_remove_all(word_lemma1, "'s")) %>%
  mutate(word_lemma2 = textstem::lemmatize_words(word2)) %>%
  mutate(word_lemma2 = str_remove_all(word_lemma2, "'s")) %>%
  left_join(race_words, by = c("word_lemma1" = "word_lemma")) %>%
  left_join(race_words, by = c("word_lemma2" = "word_lemma"))  %>%
  mutate(race_word = ifelse(race_word.x == TRUE |
                              race_word.y == TRUE, TRUE,
                            ifelse(NA))) %>%
  filter(race_word == TRUE) %>%
  mutate(bigram = paste(word_lemma1, word_lemma2)) %>%
  select (-race_word.x,-race_word.y)

#This function filters all the stop words out of the bigrams

bigrams_filtered <- race_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)

# new bigram counts:
bigram_counts <- bigrams_filtered %>%
  count(bigram, sort = TRUE) %>% 
  mutate(bigram = reorder(bigram, n)) %>% 
  top_n(15)
```


```{r bigram_chart, fig.cap="Note: This plot shows the most common cooccurrence of racial language in Absalom, Absalom!"}

bigram_plot <- plot_ly(bigram_counts,
  x = ~n,
  y = ~bigram,
  type = "bar",
  orientation = 'h',
  opacity =.9,
    hovertemplate=paste('Count: %{x}<extra></extra>')
  )
      
     bigram_plot <-  bigram_plot %>% 
        layout(title = "Fifteen Most Frequent Race Bigrams",
         xaxis = list(title = "Number of Bigrams"),
         yaxis = list(title = "Bigrams"),
         colorway=faulkner_colorway,
         paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
     margin = list(l = 50, r = 50, b = 50, t = 50, pad = 4)
     )

div(bigram_plot,align='center')
div("Figure 2: This plot shows the most common cooccurrence of racial language in Absalom, Absalom!")
```



The phrase that stands out the most is one that Rosa Coldfield uses early on "wild niggers." It becomes a leitmotif for much of the text and the phrase will be repeated throughout. Yet, who repeats it and how it is repeated will change.



```{r read_wild_use}
wild_use <- read_csv("wild_use.csv")
```


```{r plot_wild_use, fig.cap="Note: The above chart shows the respective use of the phrases 'Wild Nigger' and 'Wild Negro'. It was created by manually searching for the terms in the text and recovering the speaker."}
wild_plot <- plot_ly(
  wild_use,
  x = ~ Speaker,
  y = ~ Wild_Nigger,
  name = 'Wild Nigger',
  type = "bar",
  opacity = .9,
  hovertemplate = paste('Count: %{y}<extra></extra>')
)
wild_plot <- wild_plot %>%
  add_trace(y = ~ Wild_Negro, name = 'Wild Negro')

wild_plot <-
  wild_plot %>% layout(colorway=faulkner_colorway,
    title = "Use of 'Wild Nigger' and 'Wild Negro'<br> by different speakers in <i>Absalom, Absalom!</i>",
    xaxis = list(title = "<b>Speaker</b>"),
    yaxis = list(title = "<b>Count</b>"),
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor
  )

div(wild_plot, align='center')
div("Figure 3: The above chart shows the respective use of the phrases 'Wild Nigger' and 'Wild Negro'. It was created by manually searching for the terms in the text and recovering the speaker.")
```

In their use of either "wild niggers" or "wild negro," Quentin and Rosa Coldfield share an inverse relationship. This is curious because it is Rosa who first uses the phrase when referring to the demonic Sutpen arriving in Yoknapatawpha:

>Out of quiet thunderclap he would abrupt (man-horse-demon) upon a scene peaceful and decorous as a schoolprize water color, faint sulphur-reek still in hair clothes and beard, with grouped behind him his band of wild niggers like beasts half tamed to walk upright like men, in attitudes wild and reposed, and manacled among them the French architect with his air grim, haggard, and taller-ran. 

It is initial instance of the phrase uttered by Rosa that is carried forward throughout the text. It is therefore interesting that Quentin takes this note and appears to repeat it throughout the text. What's more, Rosa's initial association between enslavement and wildness is one that will echo throughout the text. This, despite the fact, that she says it only once.


### Distribution of racial language

We can also look at the word frequency data temporally by casting it across the chapters. This indicates the frequency of a particular word in each chapter. It may be that some racial words are used in one part of the book and not in others. This gives some indication as to its value in the narrative.   


```{r bubble_chart}
#Get the five most frequent words and group their use by chapter.

absalom_word_antijoin <- absalom_race_stats %>% 
    filter(race_word==TRUE) %>% 
    count(word_lemma, sort = TRUE) %>%
    top_n(5)

absalom_race_bubble <- absalom_race_stats %>% 
                        right_join(absalom_word_antijoin) %>% 
                        group_by(chapter) %>% 
                        count(word_lemma) %>% 
                        group_by(chapter) %>% 
                        mutate(n = reorder(n, word_lemma)) %>% 
                        mutate(word_lemma = str_to_title(word_lemma)) %>% 
                        mutate(y = 6-row_number()) %>% 
                        mutate(n = as.integer(as.character(n)))


```


```{r buble_chart_plot}


ylabels <- absalom_race_bubble %>%
  ungroup() %>%
  distinct(word_lemma) 

fig_bubble <-
  plot_ly(
    absalom_race_bubble,
    x = ~ chapter,
    y = ~ y,
    name=~word_lemma,
    color=~word_lemma,
    colors = faulkner_colorway,
    type = 'scatter',
    mode = 'markers',
    size = ~n,
    sizes = c(min(absalom_race_bubble$n), max(absalom_race_bubble$n)),
    hoverinfo='text',
    text= ~paste('Count:', n),
      marker = list(
        sizemode='diameter',
                  opacity = 0.8
            )
  )

fig_bubble <- fig_bubble %>%
  layout(
    title = "Use of Top 5 Racial words by Chapter <i>Absalom, Absalom!</i>",
    xaxis = list(title = "<b>chapter</b>",
                 showgrid = FALSE,
                 tickvals = ~chapter),
    yaxis = list(title = "",
                 showgrid = FALSE,
                 tickmode='array',
                 tickvals=c(5,4,3,2,1),
                 ticktext=ylabels$word_lemma),
    legend= list(
                 title=list(text="<b>Racial Word</b>"),
                itemsizing='constant'),
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor
    
    )


div(fig_bubble, align='center')
div("Figure 4: The above bubble chart shows the frequency of racial word use by chapter. Immediately noticeable is that the overwhelming majority of the use of hte word 'nigger' appear in chapter 7")

```
  
It is clear that chapter 7 is particularly racially charged. While certain narrators predominate in certain chapters, it would be a mistake to attribute particular words to particular characters based on this raw data. We may recall that chapter 7 is a nested narration in which we are told the story of Thomas Sutpen as related it to General Compson whot told it to Mr. Compson who told it to Quentin who is telling it to Shreve. There are so many narrative frames that would make it very difficult to determine whose language this is. What is apparent, is that the chapter in which most of Sutpen's life is revealed is steeped in pejorative racist language. To be sure, in all the other chapters the word negro or black is used more frequently to describe African Americans. 

## Part 2: Sentiment Analysis and Racial Language

Sentiment analysis is a field of CL that tries to establish the emotional valence of a segment of text. It does so through sentiment libraries. These are words that have been hand coded to indicate certain emotions like: joy, sadness, surprise, or, more broadly, positive and negative. In general, sentiment libraries are used for analyzing social media or large data sets where the narrative data tends to be less complex and operates at scale. Thus, while the sentiment dictionary might not match each sentiment exactly, in the aggregate the predominant emotion rises to the top.   

For literary works, sentiment analysis is far more speculative and merits quite some caution. Without a specially trained dictionary for a specific corpus, sentiment analysis can reveal certain patterns around words, but it is unclear what the margin of error might be. There are, so to speak, unknown unknowns. This is particularly true of Faulkner who uses many words that are emotionally charged that might not make their way into a sentiment library, or who uses words like "unamaze" to negate a particular emotion, in this case surprise. Any results that sentiment analysis generates should therefore be seen as a prompt into further inquiry and not a final result.

### Sentiment Analysis Across a Text

One of the most basic ways to think through sentiment are the positive and negative sentiments across a text. The basic procedure is to tag each positive and negative sentiment in a text and then tabulate these chunks by some logical unit, be it a sentence, paragraph, or chapter. This will give you the total sentiment of that particular unit. Since, we are interested in the emotion surrounding racial words, it makes the most sense to set the unit boundary at the sentence level. This produces a very granular chart, but for *Absalom, Absalom!* this granularity is very revealing.

```{r text_sentiment}
#Sentiment analysis across the text
race_sentences <- absalom_race_stats %>% 
                    filter(race_word==TRUE) %>% 
                    distinct()


 absalom_sentiment <- absalom_race_stats %>%
  left_join(get_sentiments("bing")) %>%  
  group_by(sentence_number) %>% 
  count(sentence_number, sentiment) %>% 
  spread(sentiment, n, fill=0) %>% 
          mutate(sentiment = positive - negative)
 
 absalom_sentiment_race <- absalom_sentiment %>% 
                            left_join(race_sentences)  %>% 
                            select(-word, -word_lemma)   %>% 
                            mutate(race_word = replace_na(race_word, FALSE)) %>%  
                            distinct() %>% 
                            spread(race_word, sentiment, fill=0) %>%  
                            rename(Race = 7, Regular = 6)


```


```{r sentiment_plot}

text_sentiment_plot <- plot_ly(absalom_sentiment_race,
  x = ~sentence_number,
  y = ~Regular,
  name='Regular',
    type = "bar",
  opacity = .9,
     hovertemplate=paste('Sentiment: %{y}<extra></extra>')
    )
text_sentiment_plot <- text_sentiment_plot %>% 
                      add_trace(y = ~Race, name = 'Race')

text_sentiment_plot <- text_sentiment_plot %>% layout(title = "Sentiment surrounding racial and non-racial words in <i>Absalom, Absalom</i>",
         xaxis = list(title = "<b>Sentence Number</b>"),
         yaxis = list(title = "<b>Sentiment Count</b>"),
         colorway=faulkner_colorway,
         paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
      margin = list(l = 50, r = 50, b = 50, t = 50, pad = 4)
         )

div(text_sentiment_plot, align='center')
div("Figure 5: The line chart shows the positive and negative of sentences. Whenever a sentence had a racial word in it, it was coded as orange.")

```

One of the immediate things that stands out about this chart is just how negatively charged sentences in *Absalom, Absalom!* are. There are very few positive sentences in this text. The sentences that contain racial words are predominately negative. In fact, the sentence with the most negative emotions attached to it is also racially charged. This is sentence 1421 which, at 969 words, is also one of the longest sentences in the text. If you do not know *Absalom, Absalom!* by sentence, and I hope you don't, this is the passage that speaks of Sutpen's dissolution in the wake of the Civil War, and his drunken parleys with Wash Jones. The reason for the overabundance of negative emotions is both the sentence length and its grotesque content.


## Part 3: Character Word Analysis

Understanding when a certain word is used and in what emotional context does not necessarily indicate who is using it. There is currently no way to determine who is speaking in *Absalom, Absalom!* This is both a practical computational issue in terms of matching speaker with dialogue, but, more philosophically, we may also wonder if anyone's language is truly their own in the text. This is a community that has been shaped by the same story for generations. The cadence, register, and tone all inform particular leitmotifs that occur and reoccur throughout the narrative. Indeed, one of the interesting phenomena that CL reveals is just how often certain turns of phrase are repeated, re-worked, and re-contextualized. The singularity of the speaker is unsettled by the multiplicity of the spoken.

That being said, it is possible to investigate the proximity of racial words relative to characters. The *Digital Yoknapatawpha* database breaks down a text into events, which are, in turn, composed of locations and characters. By cross-referencing the words with the events, we can get some notion of what words are being used around what characters. This re-composition process is quite technical and the full process is documented here: [link](absalom_text_processing_supplement.html).



```{r count_race_words}
#Once the sentences have been matched, the full sentences is unnested, the words lemmatized, and inner_joined with the race words. These are then grouped by EventID and counted and pivot wider on each race word.

absalom_race_words <- absalom_event_sentences %>%
  unnest_tokens(word, event_sentence)  %>%
  mutate(word_lemma = textstem::lemmatize_words(word)) %>%
  mutate(word_lemma = str_remove_all(word_lemma, "'s")) %>%
  inner_join(race_words) %>%
  group_by(EventID, word_lemma)  %>%
  count(word_lemma) %>%
  pivot_wider(names_from = word_lemma,
              values_from = n,
              values_fill = 0)
```

```{r read_all_absalom_events}
absalom_all_events <- read_csv("absalom_all_events_2021_4_30.csv")
```

```{r clean_up_absalom_events}
#The full table is long and hard to work with. 

absalom_events_short <- absalom_all_events %>%
  select(3, 9, 21:27, 50, 52:54)
```

```{r add_racial_events}
#Join the race events to all of the events and drop events that don't include racial events. 
absalom_race_events <- absalom_events_short %>% 
                        inner_join(absalom_race_words)
```


```{r get_race_character}
#Create count of character occurrence, useful for sorting and proportionality
character_occurrence <-  absalom_events_short %>% 
                          count(CharacterName, name="char_count")


absalom_race_character <- absalom_race_events %>% 
                          group_by(CharacterName) %>% 
                           summarise(across(black:miscegenation, ~sum(.))) %>% 
                            left_join(character_occurrence) %>% 
                            arrange(desc(char_count)) 
                          
#Note: In a previous iteration of the code, I tested whether there was a difference between character present and character mentioned. Other than the usual proportion of present and mentioned differences this did not lead ot an interesting result. 
```


### Top Race Words and Characters

While every character can be matched with the number of each word that occurs with them, this is not a relevant statistic. The words that make the most sense are the five most frequent race words discussed in figure BLANK. These are "blood," "black," "negro," "nigger," and "white." As each character necessarily occurs with each word at a different frequency, the top five characters were selected by the number of appearances in the total number of the events.  

```{r race_char_chart}
absalom_race_n <- absalom_race_character %>%
  top_n(5) %>%
  select(1:3, 5:6, 10)

fig_race_bar <-
  plot_ly(
    absalom_race_n,
    x = ~ CharacterName,
    y = ~ black,
    type = 'bar',
    name = 'Black',
    hovertemplate = paste(
      'Character: %{x}',
      '<br>',
      'Word: Black',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
  )
fig_race_bar <-
  fig_race_bar %>% add_trace(
    y = ~ blood,
    name = 'Blood',
    hovertemplate = paste(
      'Character: %{x}',
      '<br>',
      'Word: Blood',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
  )
fig_race_bar <-
  fig_race_bar %>% add_trace(
    y = ~ negro,
    name = 'Negro',
    hovertemplate = paste(
      'Character: %{x}',
      '<br>',
      'Word: Negro',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
  )
fig_race_bar <-
  fig_race_bar %>% add_trace(
    y = ~ nigger,
    name = 'Nigger',
    hovertemplate = paste(
      'Character: %{x}',
      '<br>',
      'Word: Nigger',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
  )
fig_race_bar <-
  fig_race_bar %>% add_trace(
    y = ~ white,
    name = 'White',
    hovertemplate = paste(
      'Character: %{x}',
      '<br>',
      'Word: White',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
  )

fig_race_bar <- fig_race_bar %>%
  layout(
    title = "Frequency of Racial Words in Events with Specific Characters",
    yaxis = list(title = 'Count'),
    xaxis = list(title = 'Character'),
    barmode = 'group',
    colorway = faulkner_colorway,
    margin = list(l = 50, r = 50, b = 50, t = 50, pad = 4)
  )


div(fig_race_bar, align='center')
div("Figure 6: Frequency of character appearance in events with race words.")
```


```{r char_count_sutpen}
Sutpen_occurrence <- character_occurrence %>% filter(CharacterName=="Thomas Sutpen") %>% select(2)
```


The resulting chart is quite revealing. Among most of the characters, the ratio of the word Negro vs. the N-word is relatively even. The most obvious difference is Thomas Sutpen. In events where is he present or mentioned the n-word occurs `r absalom_race_n$nigger[1]` times. Part of the reason for this is that Thomas Sutpen occurs in the most events throughout the text, `r Sutpen_occurrence$char_count[1]` to be exact. Consequently, it makes sense that he has a higher chance of occurring in those events in which there is a particular racial word. 

```{r}
n_word_frequency <-  absalom_word_frequency %>% 
                      filter(word_lemma=="nigger")
```

In order to get a better view into how often a racial word is used in the same event as a character, we need to normalize the data by the number of times the word occurs. This way we can understand proportionally, how often a character is in an event where a particular word occurs. We know from the previous chart that the n-word occurs `r n_word_frequency$n[1]` times. Dividing the number of occurrences for each character by this number produces the percentage chart below. 

#### Race chart data

```{r}

n_word_character <- absalom_race_events %>% 
                          group_by(CharacterName) %>% 
                           summarise(across(nigger, ~sum(.)/n_word_frequency$n)) %>% 
                          top_n(10) %>% 
                           mutate(CharacterName = reorder(CharacterName, desc(nigger))) 
Sutpen_n_word_percent <- n_word_character %>% filter(CharacterName=="Thomas Sutpen") 
```


#### Nword Frequency chart

```{r}
n_word_character_plot <- plot_ly(
  n_word_character,
  x = ~ nigger,
  y = ~ CharacterName,
  type = "bar",
  orientation = 'h',
  opacity=.9,
  
   hovertemplate=paste('Percentage: %{x}<extra></extra>')
  )

n_word_character_plot <- n_word_character_plot %>%
  layout(
    title = "Ten Most Frequent Word by Non-Race and Race Words",
    xaxis = list(title = "Percentage of N-word Usage", tickformat= ',.0%'),
    yaxis = list(title = "Character"),
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    colorway= faulkner_colorway,
    margin = list(l = 50, r = 50, b = 50, t = 50, pad = 4)
    
  )

div(n_word_character_plot, align = "center")
div("Figure 7: The chart displays the character occurrence relative to the number of times the word 'nigger' appears")


```

The chart reveals, quite dramatically, that Thomas Sutpen is in some way part of the event `r (Sutpen_n_word_percent$nigger[1])*100`% of the times that the n-word occurs. While it is not clear that he is using the word, it is clear that he is the character with whom the racial epithet is most associated. Indeed, in one event it occurs 16 times. This is when Sutpen is barred from entering the front door of the plantation by the enslaved butler (187). It is this primal incident that shapes so much of Sutpen's consciousness going forward, and it becomes the gravitational center that pulls in the worst racial language American literature has to offer at the moment that he becomes aware of his class difference it redounds to racial antagonism.

### Time and Racial Language

The use of racial language is also time bound. Certain words are more prominent during certain periods than others. The *DY* data also includes speculative dates for each event. These  dates consist of both an earliest possible start date and latest possible end date. Needless to say, establishing Faulkner's chronology is not an exact science and the dates are best seen as an approximate measure. Nevertheless, they do give a general indication around what time the events take place.

```{r race_by_date}
absalom_race_date <- absalom_race_events %>%
                          distinct(EventID,.keep_all=TRUE) %>%
                          mutate(StartDate = as.numeric(paste(str_sub(StartDate, 1,3),0,sep = ""))) %>% 
                          group_by(StartDate) %>% 
                           summarise(across(black:white, ~sum(.))) %>% 
                            select(StartDate, black, blood, negro, nigger, white)
                           

```

```{r race_date_plot}


fig_race_date <- plot_ly(
  absalom_race_date,
  x =  ~ StartDate,
  y =  ~ black,
  name = "Black",
  type = 'scatter',
  mode = 'lines+markers',
  opacity=.4,
  hovertemplate = paste(
    'Decade: %{x}s',
    '<br>',
    'Word: Black',
    '<extra></extra>',
    '<br>',
    'Count: %{y}'
  )
)
fig_race_date <-
  fig_race_date %>% add_trace(
    y =  ~ negro,
    name = "Negro",
    type = 'scatter',
    mode = 'lines+markers',
    hovertemplate = paste(
      'Decade: %{x}s',
      '<br>',
      'Word: Negro',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
    
  )
fig_race_date <-
  fig_race_date %>% add_trace(
    y =  ~ nigger,
    name = "Nigger",
    type = 'scatter',
    mode = 'lines+markers',
    opacity = .9,
    hovertemplate = paste(
      'Decade: %{x}s',
      '<br>',
      'Word: Nigger',
      '<extra></extra>',
      '<br>',
      'Count: %{y}'
    )
  )
fig_race_date <- fig_race_date %>%
  layout(
    title = "Frequency of Race Words over Time",
    xaxis = list(title = "Date by Decade"),
    yaxis = list(title = "Count of Word"),
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    colorway = faulkner_colorway,
    margin = list(
      l = 50,
      r = 50,
      b = 50,
      t = 50,
      pad = 4
    )
    
  )

div(fig_race_date, align = "center")
div("Figure 8: Timeline of when each racial word is used.")

```

To highlight the trajectory of the n-word, the opacity of the other two words has been turned down a bit. What is immediately visible is that the n-word is the most used word in the 1830s and 1860s. These are two great chapters in the Sutpen saga: the establishment of a racial enslavement regime and its dissolution. During Reconstruction, the words Black and Negro are used more frequently, albeit only a very few number of times. Interestingly, the lines bifurcate from 1900 to 1910. This is because the year 1909 is grouped with 1900 and not 1910. Likely what is visible is the difference in the usage of the n-word by Rosa Coldfield and Shreve and Quentin. 


### Mapping Racial Words

We can also see where racial words take place.

```{r}
absalom_race_map <- absalom_race_events %>%
                          distinct(EventID,.keep_all=TRUE) %>%
                          group_by(LocationTitle, X, new_y) %>% 
                           summarise(across(black:white, ~sum(.))) %>%
                            select(LocationTitle,X,new_y, black, negro, nigger) %>% 
                            pivot_longer(4:6) %>% 
                            filter(value>0) %>% 
                            ungroup() %>% 
                           arrange(desc(value))

```

```{r}


fig_race_map <-
  plot_ly(
    absalom_race_map,
    x = ~ X,
    y = ~ new_y,
    name=~name,
    color=~name,
    #colors = faulkner_colorway,
    type = 'scatter',
    mode = 'markers',
    size = ~value,
    sizes = c(min(absalom_race_map$value)*1.5, max(absalom_race_map$value)*1.5),
      hoverinfo='text',
    text= ~paste('Count:', value,'<br>',LocationTitle),
      marker = list(
        sizemode='diameter',
                  opacity = .4,
                  line = list(width = 1, color = ~name)
            )
  )
fig_race_map <- fig_race_map %>%
  layout(
    title = "Ten Most Frequent Word by Non-Race and Race Words",
    xaxis = list(title = ""),
    yaxis = list(title = ""),
    paper_bgcolor = faulkner_paperbackground,
    plot_bgcolor = faulkner_plotcolor,
    colorway= faulkner_colorway,
    margin = list(l = 50, r = 50, b = 50, t = 50, pad = 4),
    images = list(
      list(
        source =  "https://github.com/charlottesirot/elementR/blob/master/inst/www/2.png?raw=true",
        xref = "x",
        yref = "y",
        x = 1,
        y = 3,
        sizex = 2,
        sizey = 2,
        sizing = "stretch",
        opacity = 0.4,
        layer = "below"
      )
  ))

fig_race_map

```






## Conclusion

To be continued...


