---
title: '*Absalom, Absalom!* Sentiment Analysis'
author: "Johannes Burgers"
output:
  html_document:
    df_print: paged
---


```{r setup, include=FALSE, message = FALSE, warning=FALSE, error=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE, error=FALSE)
```

## Introduction

The following is a brief linguistic analysis of the use of racially charged language in William Faulkner's *Absalom, Absalom!*. Faulkner's representation of race was complicated, just as his own his relationship with race was complex. As a Southern white moderate, he voiced his anguish over the dehumanization of African Americans under Jim Crow segregation, and at the same time could also casually refer to people as "niggers" during the public retelling of a [comic story](https://faulkner.lib.virginia.edu/display/wfaudio02_2.html#wfaudio02_2.2). Indeed, there is no shortage of literature on Faulkner and race in general, and with regards to *Absalom, Absalom!* in particular. Given this extensive critical history, it almost goes without saying, that a computational analysis of word choice, especially with regard to racially charged language, cannot due justice to the complexities and nuances of either the text or Faulkner's broader critical intervention. Nevertheless, using techniques common in corpus linguistics (CL) it is possible to give a birds-eye view of how the use of certain words is patterned, this pattern can then, in turn, inform subsequent close readings. 

The following piece uses several techniques available to standard CL analysis, and one more complex analysis that is exclusively available to practitioners who have access to the [Digital Yoknapatawpha](http://faulkner.iath.virginia.edu/) data set. These different techniques have been split into different parts.

- **Part 1: Statistical Overview**  
          Analysis of the general linguistic pattern of the texts including word frequency and word           correlations.
- **Part 2: Sentiment Analysis**  
          Analysis of racially charged language and the sentiments that surround the use of those             words.
- **Part 3: Character Sentiment Analysis**  
          Sentiment analysis of specific characters. Using the data available in the *DY* database,           a sentiment pattern around certain characters was created.
          
All of the data was generated using the R programming language using the `tidyverse` suite of packages. The full repository is available at https://github.com/joostburgers/absalom_sentiment_analysis Due to copyright issues the repository does not include the Absalom, Absalom text file used for data analysis.


## Part 1: Statistical Overview *Absalom, Absalom!*

### Text pre-processing

With any textual analysis, some pre-processing is required. The steps that follow are standard procedures in CL. The text of *Absalom, Absalom!* was read in as a txt file. It was then broken into nine chapters, and further sub-setted into sentences. The individual words were subsequently "tokenized." The process of tokenization removes capital letters, special characters, and punctuation. It enables the computer to compare words more easily. Each "stop word" was then removed. These are words like: the, a, on, at, etc. that are very frequent with in any text, and do not add to the analysis. The words were then lemmatized. Lemmatization reduces a word to the word stem. For example, Negroes becomes Negro. This way all instances of the concept "Negro" are unified as one instances. This prevents creating separate counts for words like Negro, Negroes, and Negro's.

The resulting slate of words was tagged as either racially charged by adding a column called race_word and indicating TRUE or FALSE for each word. This was done by creating a list of racial words and joining it to the data table through a left sided join. Essentially, it checks to see any time a word like "Negro", "Nigger", or "Octoroon" occurs and tags it as TRUE. With this pre-processing complete it is possible to provide some key statistical insights.

### Word Frequency

The chart below shows the ten most frequent non-racial words and racial words in the text. Hovering over the the individual bars reveals their precise number, and clicking on TRUE and FALSE turns that particular series on and off.

```{r load_packages}
library(tidyverse)
library(tidytext)
library(stringi)
library(htmlTable)
library(stringr)
library(ggplot2)
library(plotly)
library(ggthemes)
library(textstem)
library(shiny)
```

```{r load_text}
#Read in the text
absalom_df <- as.data.frame(read_file("Faulkner_William_Absalom_Absalom.txt"))
colnames(absalom_df) <- "text" 
```

```{r load_race_words}
#Read in the race words
race_words <- read_csv("race_words.csv")
```


```{r unnest_text}
#unnest the text by sentence and then label each chapter number and sentence number.
absalom_tidy <- absalom_df %>%
  unnest_regex(text, text, pattern = "—[:digit:]—") %>%
  mutate(chapter = row_number()) %>%
  unnest_regex(sentences, text, pattern = "[.?!]") %>%
  mutate(sentence_number = row_number())  %>%
  unnest_tokens(word, sentences)
```

```{r word_frequency}
#Remove the stop words to reduce over counting
data("stop_words")
absalom_stats <- absalom_tidy %>%
  anti_join(stop_words)
```


```{r add_race_words}
#Mark each race word as true and then convert every non-race word as false. then add a column for the lemmatized words.

absalom_race_stats <- absalom_stats %>%
  mutate(word_lemma = textstem::lemmatize_words(word)) %>%
  mutate(word_lemma = str_remove_all(word_lemma, "'s")) %>%
  left_join(race_words, by = "word_lemma") %>%
  mutate(race_word = replace_na(race_word, FALSE))
```



```{r create_plot}
#Create a top ten list for the plotting data
absalom_word_frequency <- absalom_race_stats %>% 
    group_by(race_word) %>% 
    count(word_lemma, sort = TRUE) %>%
    top_n(10) %>%
    mutate(word_lemma = reorder(word_lemma, n))
```


```{r message=TRUE, results='markup', fig.cap="Note: The chart displays the most frequent words based on word stem.<br> This prevents counting <i>father</i> and <i>father's</i> separately."}

#Use ploty_ly library to create a bar chart

absalom_word_frequency_plot <- plot_ly(
  absalom_word_frequency,
  x = ~ word_lemma,
  y = ~ n,
  type = "bar",
  color = ~ race_word,
  hovertemplate=paste('Count: %{y}<extra></extra>')
  )

absalom_word_frequency_plot <- absalom_word_frequency_plot %>%
  layout(
    title = "Ten Most Frequent Word by Non-Race and Race Words",
    xaxis = list(title = "Word Stem"),
    yaxis = list(title = "Number of Words"),
    legend = list(title = list(text = '<b>Race Word</b>'))
  )

div(absalom_word_frequency_plot, align = "center")
div("Figure 1: The chart displays the most frequent words based on word stem.<br> This prevents counting 'father' and 'father's' separately.")

```

What is immediately noticeable is that the word "nigger" is the most frequent racial term. It exceeds the word "negro" by 50 counts. It occurs about a third as infrequently as the word Henry (the main character) and twice as infrequently as the racially ambigious Charles Bon. Importantly, the occurrences of the individual names of characters is not the same as the number of times they actually occur in the text. After all, the pronouns "he" or "she" could equally well denote a character, but that is not shown here.

### Collocations

Collocation is a process of determining what words appear together. This is done through a process of creating n-grams, where n is the number of words that might match in a sequence. By determining the n-gram around particular words, we can get a better sense of the context. For example, her research of British Newspapers, Dawn Archer has shown that the most common bigram (n-gram of two) for Muslim is "Muslim terrorist", certainly this strong association between these two words indicates how Muslim's are represented in the British media.

```{r}

#Create a bigram of the Absalom DF
absalom_bigrams <- absalom_df %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

#This function first separates the bigram into two words, lemmatizes each, tags the racial words, then removes all non-racial words. 
race_bigrams <- absalom_bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  mutate(word_lemma1 = textstem::lemmatize_words(word1)) %>%
  mutate(word_lemma1 = str_remove_all(word_lemma1, "'s")) %>%
  mutate(word_lemma2 = textstem::lemmatize_words(word2)) %>%
  mutate(word_lemma2 = str_remove_all(word_lemma2, "'s")) %>%
  left_join(race_words, by = c("word_lemma1" = "word_lemma")) %>%
  left_join(race_words, by = c("word_lemma2" = "word_lemma"))  %>%
  mutate(race_word = ifelse(race_word.x == TRUE |
                              race_word.y == TRUE, TRUE,
                            ifelse(NA))) %>%
  filter(race_word == TRUE) %>%
  mutate(bigram = paste(word_lemma1, word_lemma2)) %>%
  select (-race_word.x,-race_word.y)

#This function filters all the stop words out of the bigrams

bigrams_filtered <- race_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)

# new bigram counts:
bigram_counts <- bigrams_filtered %>%
  count(bigram, sort = TRUE) %>% 
  mutate(bigram = reorder(bigram, n)) %>% 
  top_n(15)


```


```{r bigram_chart, fig.cap="Note: This plot shows the most common cooccurrence of racial language in Absalom, Absalom!"}

bigram_plot <- plot_ly(bigram_counts,
  x = ~n,
  y = ~bigram,
  type = "bar",
  orientation = 'h',
    hovertemplate=paste('Count: %{x}<extra></extra>')
  )
      
     bigram_plot <-  bigram_plot %>% 
        layout(title = "Fifteen Most Frequent Race Bigrams",
         xaxis = list(title = "Number of Bigrams"),
         yaxis = list(title = "Bigrams")
     )

div(bigram_plot,align='center')
div("Figure 1: This plot shows the most common cooccurrence of racial language in Absalom, Absalom!")

```



The phrase that stands out the most is one that Rosa Coldfield uses early on "wild niggers." It becomes a leitmotif for much of the text and the phrase will be repeated throughout. Yet, who repeats it and how it is repeated will change.



```{r read_wild_use}
wild_use <- read_csv("wild_use.csv")
```


```{r plot_wild_use, fig.cap="Note: The above chart shows the respective use of the phrases 'Wild Nigger' and 'Wild Negro'. It was created by manually searching for the terms in the text and recovering the speaker."}
wild_plot <- plot_ly(wild_use,
  x = ~Speaker,
  y = ~Wild_Nigger,
  name='Wild Nigger',
  type = "bar",
     hovertemplate=paste('Count: %{y}<extra></extra>')
    )
wild_plot <- wild_plot %>% 
  add_trace(y = ~Wild_Negro, name = 'Wild Negro')

wild_plot <- wild_plot %>% layout(title = "Use of 'Wild Nigger' and 'Wild Negro'<br> by different speakers in <i>Absalom, Absalom!</i>",
         xaxis = list(title = "<b>Speaker</b>"),
         yaxis = list(title = "<b>Count</b>"))

div(wild_plot, align='center')
div("Figure 3: The above chart shows the respective use of the phrases 'Wild Nigger' and 'Wild Negro'. It was created by manually searching for the terms in the text and recovering the speaker.")
```

In their use of either "wild niggers" or "wild negro", Quentin and Rosa Coldfield share an inverse relationship. This is curious because it is Rosa who first uses the phrase when referring to the demonic Sutpen arriving in Yoknapatawpha:

>Out of quiet thunderclap he would abrupt (man-horse-demon) upon a scene peaceful and decorous as a schoolprize water color, faint sulphur-reek still in hair clothes and beard, with grouped behind him his band of wild niggers like beasts half tamed to walk upright like men, in attitudes wild and reposed, and manacled among them the French architect with his air grim, haggard, and taller-ran. 

It is initial instance of the phrase uttered by Rosa that is carried forward throughout the text. Indeed, the enslaved people are continuously associated with the word "wild", and it is Quentin whose narrative uses the racial epiteth more prominently than others.

```{r bubble_chart}
#Get the five most frequent words and group their use by chapter.

absalom_word_antijoin <- absalom_race_stats %>% 
    filter(race_word==TRUE) %>% 
    count(word_lemma, sort = TRUE) %>%
    top_n(5)

absalom_race_bubble <- absalom_race_stats %>% 
                        right_join(absalom_word_antijoin) %>% 
                        group_by(chapter) %>% 
                        count(word_lemma) %>% 
                        group_by(chapter) %>% 
                        mutate(n = reorder(n, word_lemma)) %>% 
                        mutate(y = row_number())
```


```{r buble_chart_plot}

fig_bubble <- plot_ly(absalom_race_bubble, x = ~chapter, y = ~y, text = ~word_lemma, type = 'scatter', mode = 'markers',
        marker = list(size = ~n, color=~y, opacity = 0.5))
fig_bubble
```

